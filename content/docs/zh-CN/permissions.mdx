---
title: 权限
description: 理解并配置权限系统
---

Ripperdoc 内置权限系统，用于避免非预期操作。

## 权限如何工作

默认情况下，Ripperdoc 在以下操作前会请求批准：

- 执行 shell 命令
- 编辑或写入文件
- 运行可能具有破坏性的操作

当出现权限提示时，你可以：

- **y/yes**：允许操作
- **n/no**：拒绝操作
- **a/always**：始终允许此类操作

## YOLO 模式

使用 YOLO 模式跳过所有权限提示：

```bash
ripperdoc --yolo
```

**警告**：仅在可信环境中使用 YOLO 模式，确保你能接受 AI 在无需确认的情况下进行修改。

## 权限配置

权限在项目级文件中配置：

1. `.ripperdoc/config.json` - 主项目配置
2. `.ripperdoc/config.local.json` - 本地覆盖（已在 gitignore 中）

### 配置 Schema

```json
{
  "allowed_tools": ["Read", "Glob", "Grep", "LS", "Edit", "Bash"],
  "working_directories": ["/path/to/allowed/dir"],
  "bash_allow_rules": [
    {
      "pattern": "npm test",
      "description": "Allow running tests"
    },
    {
      "pattern": "git status",
      "description": "Allow git status"
    }
  ],
  "bash_deny_rules": [
    {
      "pattern": "rm -rf /",
      "description": "Prevent destructive commands"
    }
  ]
}
```

### 配置字段

| 字段 | 说明 |
|-------|-------------|
| `allowed_tools` | AI 可使用的工具列表 |
| `working_directories` | 允许操作的目录 |
| `bash_allow_rules` | 自动批准 bash 命令的规则 |
| `bash_deny_rules` | 自动拒绝 bash 命令的规则 |

### 规则模式语法

规则使用 glob 风格的模式：

- `npm test` - 精确匹配
- `npm *` - 前缀匹配
- `*test*` - 包含匹配
- `git @(status|diff|log)` - 多选项

### 配置示例

#### 开发项目

```json
{
  "allowed_tools": ["Read", "Glob", "Grep", "LS", "Edit", "Write", "Bash"],
  "working_directories": ["."],
  "bash_allow_rules": [
    {"pattern": "npm *", "description": "Allow npm commands"},
    {"pattern": "git *", "description": "Allow git commands"},
    {"pattern": "python *", "description": "Allow python commands"}
  ],
  "bash_deny_rules": [
    {"pattern": "rm -rf /*", "description": "Prevent recursive delete from root"}
  ]
}
```

#### 只读分析

```json
{
  "allowed_tools": ["Read", "Glob", "Grep", "LS"],
  "bash_allow_rules": [
    {"pattern": "ls *", "description": "Allow listing"},
    {"pattern": "cat *", "description": "Allow reading"}
  ]
}
```

## 只读操作

部分只读操作会自动允许：

- `Glob` - 查找文件
- `Grep` - 搜索内容
- `Read` - 读取文件
- `LS` - 列出目录
- Shell 命令：`ls`、`cat`、`head`、`tail`、`grep`、`find`（不含重定向）

## Sandbox 模式

Bash 工具支持只读 sandbox 模式：

```json
{
  "command": "ls -la",
  "sandbox": true
}
```

Sandbox 模式：
- 禁止文件系统写入
- 禁止网络访问
- 无需权限提示

## 访问敏感目录

当访问敏感目录时，Ripperdoc 会要求确认：

- `/usr`、`/etc`、`/bin`、`/sbin`
- 系统配置目录
- 其他用户的 home 目录

## 管理权限

使用 `/permissions` 命令查看与管理权限：

```
> /permissions list
> /permissions add allow Bash "npm *"
> /permissions remove 1
```

## 本地配置覆盖

使用 `.ripperdoc/config.local.json` 存放不应提交的本地设置：

```json
{
  "bash_allow_rules": [
    {"pattern": "docker *", "description": "Local docker access"}
  ]
}
```

将 `.ripperdoc/config.local.json` 加入 `.gitignore`。

## 最佳实践

1. **先用默认设置**：在熟悉流程前，先使用默认权限系统
2. **允许常用安全命令**：为常用的安全命令建立 allow 规则
3. **显式拒绝危险模式**：例如 `rm -rf /`
4. **探索时使用 sandbox**：在不熟悉的代码库里用 sandbox 模式
5. **YOLO 需谨慎**：只有在确认风险可控后再启用 YOLO
6. **使用本地配置**：把个人/机器特定的规则放在 `config.local.json`
