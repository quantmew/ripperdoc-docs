---
title: SDK 客户端参考
description: Ripperdoc SDK 的详细 API 参考
---

## RipperdocClient

会话式交互的主类。

### 构造函数

```python
from ripperdoc.sdk import RipperdocClient

client = RipperdocClient(
    model: str = "main",
    yolo_mode: bool = False,
    max_thinking_tokens: int = 0,
    tools: Optional[List[str]] = None,
    system_prompt: Optional[str] = None,
)
```

#### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----------|------|---------|-------------|
| `model` | `str` | `"main"` | 使用的模型配置 |
| `yolo_mode` | `bool` | `False` | 跳过权限提示 |
| `max_thinking_tokens` | `int` | `0` | Thinking 模式最大 token 数 |
| `tools` | `List[str]` | `None` | 启用的工具（为空则全部启用） |
| `system_prompt` | `str` | `None` | 自定义 system prompt |

### 方法

#### query

发送消息并获取回复。

```python
async def query(
    self,
    message: str,
    stream: bool = False,
) -> QueryResult
```

**参数：**
- `message`：用户消息
- `stream`：开启流式响应

**返回：** `QueryResult` 对象

#### close

清理资源。

```python
async def close(self) -> None
```

### 上下文管理器

作为 async 上下文管理器使用：

```python
async with RipperdocClient() as client:
    result = await client.query("Hello")
```

## query 函数

用于一次性查询，无需会话管理。

```python
from ripperdoc.sdk import query

async def query(
    message: str,
    system_prompt: str = "",
    model: str = "main",
    tools: Optional[List[str]] = None,
    max_thinking_tokens: int = 0,
) -> QueryResult
```

### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----------|------|---------|-------------|
| `message` | `str` | 必填 | 查询消息 |
| `system_prompt` | `str` | `""` | System prompt |
| `model` | `str` | `"main"` | 模型配置 |
| `tools` | `List[str]` | `None` | 启用工具 |
| `max_thinking_tokens` | `int` | `0` | Thinking 模式 token 数 |

## QueryResult

查询返回的结果对象。

### 属性

| 属性 | 类型 | 说明 |
|----------|------|-------------|
| `content` | `str` | 回复文本 |
| `tool_calls` | `List[ToolCall]` | 调用过的工具 |
| `input_tokens` | `int` | 输入 token 数 |
| `output_tokens` | `int` | 输出 token 数 |
| `cost_usd` | `float` | 预估费用 |
| `duration_ms` | `float` | 响应耗时 |

## 示例

### 基础查询

```python
from ripperdoc.sdk import query

result = await query("What is 2 + 2?")
print(result.content)  # "4"
```

### 使用工具

```python
from ripperdoc.sdk import RipperdocClient

client = RipperdocClient(
    tools=["Read", "Glob"],
    yolo_mode=True
)

result = await client.query("List all Python files")
print(result.content)
```

### Thinking 模式

```python
from ripperdoc.sdk import query

result = await query(
    "Solve this complex problem step by step...",
    max_thinking_tokens=8000,
    model="reasoning"
)
```

### 流式输出

```python
from ripperdoc.sdk import RipperdocClient

client = RipperdocClient()

async for chunk in client.query("Write a long story", stream=True):
    print(chunk, end="", flush=True)
```

### 错误处理

```python
from ripperdoc.sdk import RipperdocClient, RipperdocError

try:
    client = RipperdocClient()
    result = await client.query("Do something")
except RipperdocError as e:
    print(f"Error: {e}")
finally:
    await client.close()
```

## 工具访问控制

控制可用工具：

```python
# Only file reading tools
client = RipperdocClient(tools=["Read", "Glob", "Grep"])

# All tools except shell
all_tools = get_all_tool_names()
safe_tools = [t for t in all_tools if t != "Bash"]
client = RipperdocClient(tools=safe_tools)
```

## 自定义 system prompt

```python
client = RipperdocClient(
    system_prompt="""You are a code reviewer.
    Focus on:
    - Security issues
    - Performance problems
    - Code style
    """
)

result = await client.query("Review the changes in src/")
```
