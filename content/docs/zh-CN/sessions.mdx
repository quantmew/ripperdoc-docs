---
title: 会话
description: 管理对话会话与历史
---

Ripperdoc 会保存会话历史，以支持上下文对话和会话恢复。

## 会话存储

会话以 JSON 文件形式存放在 `~/.ripperdoc/sessions/`，包含：

- 完整对话记录
- 工具执行历史
- Token 用量与费用
- 会话元数据

## 恢复会话

### 继续最近会话

继续当前目录中最近一次会话：

```bash
ripperdoc --continue
# 或
ripperdoc -c
# 或使用别名
rd -c
```

这会自动恢复上一次会话，无需选择。

### 交互式选择会话

在交互会话中使用 `/resume` 命令选择历史会话：

```
> /resume
```

这会打开一个交互式选择器，浏览并选择历史会话。

## 会话命令

### 查看状态

```
> /status
```

显示当前会话信息，包括：
- 消息数量
- Token 用量
- 时长
- 工具调用

### 查看统计

```
> /stats
```

显示更详细的会话统计：
- 输入/输出 Token
- 缓存命中
- 费用明细
- 工具使用明细

### 查看费用

```
> /cost
```

显示 token 使用与预估费用。

## 上下文管理

### 清空历史

清空当前对话：

```
> /clear
```

这会开始一段新的对话，但保留当前会话。

### 压缩历史

当上下文窗口接近上限时，Ripperdoc 会通过摘要自动压缩早期消息。

手动触发压缩：

```
> /compact
```

也可以提供自定义指令：

```
> /compact 重点保留 API 实现细节
```

## 会话配置

通过环境变量配置会话行为：

| 变量 | 说明 | 默认值 |
|----------|-------------|---------|
| `RIPPERDOC_AUTO_COMPACT` | 启用自动压缩 | `true` |
| `RIPPERDOC_CONTEXT_TOKENS` | 上下文窗口大小限制 | 模型默认值 |

或在 `~/.ripperdoc.json` 中配置：

```json
{
  "auto_compact_enabled": true,
  "context_token_limit": 100000
}
```

## 上下文长度处理

当超过上下文长度限制时：

1. Ripperdoc 检测到上下文长度错误
2. 自动压缩旧消息
3. 使用压缩后的上下文重试请求
4. 如有压缩会通知你

## 导出会话

会话文件是 JSON，可用于：

- 手动备份
- 分析使用模式
- 共享以便排查问题

会话文件位置：`~/.ripperdoc/sessions/<project-hash>/<session-id>.json`

## 最佳实践

1. **新任务用 `/clear`**：切换到无关任务时重新开始
2. **长会话关注 `/cost`**：跟踪 token 用量
3. **中断后用 `-c` 或 `--continue`**：继续之前的工作
4. **主动压缩**：响应变慢时用 `/compact`
5. **用 `/resume` 浏览历史**：交互式查找特定的历史会话
