---
title: 配置
description: 配置 Ripperdoc 的模型与行为
---

Ripperdoc 可以通过配置文件或环境变量进行设置。

## 配置文件

配置按优先级顺序加载：

1. **全局**：`~/.ripperdoc.json`
2. **项目**：`.ripperdoc/config.json`
3. **本地**：`.ripperdoc/config.local.json`（已在 gitignore 中）

项目和本地配置会覆盖全局配置。

## 模型配置

### 基础模型设置

```json
{
  "model_profiles": {
    "default": {
      "provider": "openai_compatible",
      "model": "deepseek-chat",
      "api_key": "YOUR_DEEPSEEK_KEY",
      "api_base": "https://api.deepseek.com",
      "max_tokens": 4096,
      "temperature": 0.0
    }
  },
  "model_pointers": {
    "main": "default",
    "quick": "default"
  }
}
```

### 多模型

可以定义多个模型配置：

```json
{
  "model_profiles": {
    "default": {
      "provider": "openai_compatible",
      "model": "deepseek-chat",
      "api_key": "YOUR_DEEPSEEK_KEY",
      "api_base": "https://api.deepseek.com"
    },
    "reasoner": {
      "provider": "openai_compatible",
      "model": "deepseek-reasoner",
      "api_key": "YOUR_DEEPSEEK_KEY",
      "api_base": "https://api.deepseek.com",
      "thinking_mode": "deepseek"
    },
    "local": {
      "provider": "openai_compatible",
      "model": "llama3.2",
      "api_base": "http://localhost:11434/v1",
      "api_key": null
    }
  },
  "model_pointers": {
    "main": "default",
    "quick": "reasoner"
  }
}
```

使用 `/models` 命令或 `--model` 参数切换配置（使用 `model_profiles` 中的名字）：

```bash
ripperdoc --model reasoner
```

### 模型配置字段

| 字段 | 说明 | 必需 |
|-------|-------------|----------|
| `provider` | 提供商类型 | 是 |
| `model` | 模型标识符 | 是 |
| `api_key` | API 密钥（或使用环境变量） | 依提供商而定 |
| `api_base` | API 基础 URL | 依提供商而定 |
| `auth_token` | Bearer token 认证 | 否 |
| `max_tokens` | 最大输出 token | 否 |
| `temperature` | 采样温度 | 否 |
| `thinking_mode` | 扩展思考模式 | 否 |
| `context_window` | 上下文窗口大小 | 否 |
| `openai_tool_mode` | OpenAI 工具调用模式 | 否 |
| `input_cost_per_million_tokens` | 费用追踪（输入） | 否 |
| `output_cost_per_million_tokens` | 费用追踪（输出） | 否 |

### 提供商选项

| Provider | 必需配置 | 说明 |
|----------|-----------------|-------------|
| `openai_compatible` | `api_base`, `model` | 任意 OpenAI 兼容 API |
| `anthropic` | `api_key` | Anthropic Claude |
| `gemini` | `api_key` | Google Gemini |

### 认证选项

```json
{
  "model_profiles": {
    "with_api_key": {
      "provider": "openai_compatible",
      "api_key": "sk-xxx",
      "api_base": "https://api.example.com/v1",
      "model": "model-name"
    },
    "with_bearer_token": {
      "provider": "openai_compatible",
      "auth_token": "your-bearer-token",
      "api_base": "https://api.example.com/v1",
      "model": "model-name"
    }
  }
}
```

## Thinking 模式

针对支持扩展思考的模型（DeepSeek、带扩展思考的 Claude）：

```json
{
  "model_profiles": {
    "reasoning": {
      "provider": "openai_compatible",
      "model": "deepseek-reasoner",
      "api_key": "YOUR_DEEPSEEK_KEY",
      "api_base": "https://api.deepseek.com",
      "thinking_mode": "deepseek"
    }
  }
}
```

Thinking 模式选项：

| 模式 | 说明 |
|------|-------------|
| `none` | 禁用扩展思考（默认） |
| `deepseek` | DeepSeek 风格思考 |
| `anthropic` | Anthropic 风格思考（Claude） |

### OpenAI 工具模式

控制工具如何呈现给 OpenAI 兼容模型：

```json
{
  "model_profiles": {
    "custom": {
      "provider": "openai_compatible",
      "model": "model-name",
      "openai_tool_mode": "native"
    }
  }
}
```

选项：
- `native` - 使用 OpenAI 原生工具调用
- `text` - 使用文本形式的工具描述

## 费用追踪

按模型追踪 token 费用：

```json
{
  "model_profiles": {
    "expensive": {
      "provider": "openai_compatible",
      "model": "gpt-4",
      "api_key": "YOUR_KEY",
      "api_base": "https://api.openai.com/v1",
      "input_cost_per_million_tokens": 30.0,
      "output_cost_per_million_tokens": 60.0
    }
  }
}
```

## 自定义 API 端点

针对 OpenAI 兼容接口：

```json
{
  "model_profiles": {
    "custom": {
      "provider": "openai_compatible",
      "api_base": "https://your-api-endpoint.com/v1",
      "api_key": "YOUR_CUSTOM_KEY",
      "model": "your-model-name"
    }
  },
  "model_pointers": {
    "main": "custom",
    "quick": "custom"
  }
}
```

## 权限设置

```json
{
  "allowed_tools": ["Read", "Glob", "Grep", "LS", "Edit", "Bash"],
  "bash_allow_rules": [
    {"pattern": "npm *", "description": "Allow npm"}
  ],
  "bash_deny_rules": [
    {"pattern": "rm -rf /", "description": "Block dangerous"}
  ]
}
```

详细配置参见 [权限](/zh-CN/docs/permissions)。

## 主题配置

Ripperdoc 内置主题系统，用于自定义 CLI 外观。在全局配置中设置首选主题：

```json
{
  "theme": "dark"
}
```

### 可用主题

| 主题 | 说明 |
|-------|-------------|
| `dark` | 默认深色主题，带青色强调色 |
| `light` | 适用于亮色终端的浅色主题 |
| `monokai` | Monokai 风格配色方案 |
| `dracula` | Dracula 配色方案 |
| `solarized_dark` | Solarized 深色配色方案 |
| `nord` | 北欧风格，偏蓝配色方案 |

在运行时使用 `/themes` 命令切换主题：

```
> /themes              # 显示当前主题并列出可用主题
> /themes light        # 切换到浅色主题
> /themes preview nord # 预览 nord 主题颜色
```

## CLI 参数

| 参数 | 说明 |
|--------|-------------|
| `--model NAME` | 使用指定模型配置 |
| `--yolo` | 跳过权限确认 |
| `--verbose` | 启用详细输出 |
| `--max-thinking-tokens N` | 设置最大思考 token 数 |
| `-c`, `--continue` | 继续上次会话 |
| `-p`, `--prompt TEXT` | 非交互式提示 |

## 环境变量

API key 可以直接写在配置文件里。环境变量是可选的，也可以用来替代。

| 变量 | 说明 |
|----------|-------------|
| `ANTHROPIC_API_KEY` | 如果已在配置里设置 `api_key` 则可选 |
| `OPENAI_API_KEY` | 如果已在配置里设置 `api_key` 则可选 |
| `DEEPSEEK_API_KEY` | 如果已在配置里设置 `api_key` 则可选 |
| `GEMINI_API_KEY` | 如果已在配置里设置 `api_key` 则可选 |
| `RIPPERDOC_MAX_RETRIES` | API 最大重试次数（默认：10） |
| `RIPPERDOC_API_TIMEOUT` | API 超时时间（秒，默认：120） |

完整列表参见 [环境变量](/zh-CN/docs/environment-variables)。
